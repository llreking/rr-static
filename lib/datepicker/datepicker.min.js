window.datePicker=(function(){var a=function(){this.gearDate;this.minY=1900;this.minM=1;this.minD=1;this.maxY=2099;this.maxM=12;this.maxWidth=400;this.maxD=31;this.value=""};a.prototype={init:function(e){this.type=e.type;this.trigger=document.querySelector(e.trigger);if(this.trigger.getAttribute("data-lcalendar")!=null){var b=this.trigger.getAttribute("data-lcalendar").split(",");var d=b[0].split("-");this.minY=~~d[0];this.minM=~~d[1];this.minD=~~d[2];var c=b[1].split("-");this.maxY=~~c[0];this.maxM=~~c[1];this.maxD=~~c[2]}if(e.minDate){var d=e.minDate.split("-");this.minY=~~d[0];this.minM=~~d[1];this.minD=~~d[2]}if(e.maxDate){var c=e.maxDate.split("-");this.maxY=~~c[0];this.maxM=~~c[1];this.maxD=~~c[2]}if(e.maxWidth){this.maxWidth=e.maxWidth}this.onClose=e.onClose;this.onSubmit=e.onSubmit;this.onChange=e.onChange;this.bindEvent(this.type)},bindEvent:function(B){var c=this;var q=false,p=false;var v;var b=(typeof(c.maxWidth)=="number"||(!(c.maxWidth+"").contains("%")&&!(c.maxWidth+"").contains("px"))?c.maxWidth+"px":c.maxWidth);function r(G){c.gearDate=document.createElement("div");c.gearDate.className="gearDate";c.gearDate.innerHTML='<div class="dp-outer-box"><div style="max-width:'+b+'" class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div></div></div></div></div><div class="date_bg" style="width:100%;height:100%;"></div>';document.body.appendChild(c.gearDate);f();var I=c.gearDate.querySelector(".lcalendar_cancel");I.addEventListener("touchstart",e);var J=c.gearDate.querySelector(".lcalendar_finish");J.addEventListener("touchstart",h);var H=c.gearDate.querySelector(".date_bg");H.addEventListener("click",e);var F=c.gearDate.querySelector(".date_yy");var E=c.gearDate.querySelector(".date_mm");var D=c.gearDate.querySelector(".date_dd");F.addEventListener("touchstart",o);E.addEventListener("touchstart",o);D.addEventListener("touchstart",o);F.addEventListener("touchmove",m);E.addEventListener("touchmove",m);D.addEventListener("touchmove",m);F.addEventListener("touchend",l);E.addEventListener("touchend",l);D.addEventListener("touchend",l);I.addEventListener("click",e);J.addEventListener("click",h);F.addEventListener("mousedown",o);E.addEventListener("mousedown",o);D.addEventListener("mousedown",o);F.addEventListener("mousemove",m);E.addEventListener("mousemove",m);D.addEventListener("mousemove",m);F.addEventListener("mouseup",l);E.addEventListener("mouseup",l);D.addEventListener("mouseup",l);c.gearDate.querySelector(".date_roll_mask").addEventListener("mouseleave",n);c.gearDate.querySelector(".date_roll_mask").addEventListener("mouseup",n)}function f(){var D=new Date();var E={yy:D.getYear(),mm:D.getMonth(),dd:D.getDate()-1};if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(c.trigger.value)){rs=c.trigger.value.match(/(^|-)\d{1,4}/g);E.yy=rs[0]-c.minY;E.mm=rs[1].replace(/-/g,"")-1;E.dd=rs[2].replace(/-/g,"")-1}else{E.yy=E.yy+1900-c.minY}c.gearDate.querySelector(".date_yy").setAttribute("val",E.yy);c.gearDate.querySelector(".date_mm").setAttribute("val",E.mm);c.gearDate.querySelector(".date_dd").setAttribute("val",E.dd);x()}function u(F){c.gearDate=document.createElement("div");c.gearDate.className="gearDate";c.gearDate.innerHTML='<div class="dp-outer-box"><div class="date_ctrl slideInUp" style="max-width:'+b+'"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="ym_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div></div></div></div></div><div class="date_bg" style="width:100%;height:100%;"></div>';document.body.appendChild(c.gearDate);C();var H=c.gearDate.querySelector(".lcalendar_cancel");H.addEventListener("touchstart",e);var I=c.gearDate.querySelector(".lcalendar_finish");I.addEventListener("touchstart",k);var G=c.gearDate.querySelector(".date_bg");G.addEventListener("click",e);var E=c.gearDate.querySelector(".date_yy");var D=c.gearDate.querySelector(".date_mm");E.addEventListener("touchstart",o);D.addEventListener("touchstart",o);E.addEventListener("touchmove",m);D.addEventListener("touchmove",m);E.addEventListener("touchend",l);D.addEventListener("touchend",l);H.addEventListener("click",e);I.addEventListener("click",k);E.addEventListener("mousedown",o);D.addEventListener("mousedown",o);E.addEventListener("mousemove",m);D.addEventListener("mousemove",m);E.addEventListener("mouseup",l);D.addEventListener("mouseup",l);c.gearDate.querySelector(".date_roll_mask").addEventListener("mouseleave",n);c.gearDate.querySelector(".date_roll_mask").addEventListener("mouseup",n)}function C(){var D=new Date();var E={yy:D.getYear(),mm:D.getMonth()};if(/^\d{4}-\d{1,2}$/.test(c.trigger.value)){rs=c.trigger.value.match(/(^|-)\d{1,4}/g);E.yy=rs[0]-c.minY;E.mm=rs[1].replace(/-/g,"")-1}else{E.yy=E.yy+1900-c.minY}c.gearDate.querySelector(".date_yy").setAttribute("val",E.yy);c.gearDate.querySelector(".date_mm").setAttribute("val",E.mm);x()}function s(G){c.gearDate=document.createElement("div");c.gearDate.className="gearDatetime";c.gearDate.innerHTML='<div class="dp-outer-box"><div class="date_ctrl slideInUp" style="max-width:'+b+'"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div></div><div class="date_bg" style="width:100%;height:100%;"></div>';document.body.appendChild(c.gearDate);g();var I=c.gearDate.querySelector(".lcalendar_cancel");I.addEventListener("touchstart",e);var J=c.gearDate.querySelector(".lcalendar_finish");J.addEventListener("touchstart",i);var H=c.gearDate.querySelector(".date_bg");H.addEventListener("click",e);var F=c.gearDate.querySelector(".date_yy");var E=c.gearDate.querySelector(".date_mm");var D=c.gearDate.querySelector(".date_dd");var K=c.gearDate.querySelector(".time_hh");var L=c.gearDate.querySelector(".time_mm");F.addEventListener("touchstart",o);E.addEventListener("touchstart",o);D.addEventListener("touchstart",o);K.addEventListener("touchstart",o);L.addEventListener("touchstart",o);F.addEventListener("touchmove",m);E.addEventListener("touchmove",m);D.addEventListener("touchmove",m);K.addEventListener("touchmove",m);L.addEventListener("touchmove",m);F.addEventListener("touchend",l);E.addEventListener("touchend",l);D.addEventListener("touchend",l);K.addEventListener("touchend",l);L.addEventListener("touchend",l);I.addEventListener("click",e);J.addEventListener("click",i);F.addEventListener("mousedown",o);E.addEventListener("mousedown",o);D.addEventListener("mousedown",o);K.addEventListener("mousedown",o);L.addEventListener("mousedown",o);F.addEventListener("mousemove",m);E.addEventListener("mousemove",m);D.addEventListener("mousemove",m);K.addEventListener("mousemove",m);L.addEventListener("mousemove",m);F.addEventListener("mouseup",l);E.addEventListener("mouseup",l);D.addEventListener("mouseup",l);K.addEventListener("mouseup",l);L.addEventListener("mouseup",l);c.gearDate.querySelector(".date_roll_mask").addEventListener("mouseleave",n);c.gearDate.querySelector(".date_roll_mask").addEventListener("mouseup",n)}function g(){var D=new Date();var E={yy:D.getYear(),mm:D.getMonth(),dd:D.getDate()-1,hh:D.getHours(),mi:D.getMinutes()};if(/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(c.trigger.value)){rs=c.trigger.value.match(/(^|-|\s|:)\d{1,4}/g);E.yy=rs[0]-c.minY;E.mm=rs[1].replace(/-/g,"")-1;E.dd=rs[2].replace(/-/g,"")-1;E.hh=parseInt(rs[3].replace(/\s0?/g,""));E.mi=parseInt(rs[4].replace(/:0?/g,""))}else{E.yy=E.yy+1900-c.minY}c.gearDate.querySelector(".date_yy").setAttribute("val",E.yy);c.gearDate.querySelector(".date_mm").setAttribute("val",E.mm);c.gearDate.querySelector(".date_dd").setAttribute("val",E.dd);x();c.gearDate.querySelector(".time_hh").setAttribute("val",E.hh);c.gearDate.querySelector(".time_mm").setAttribute("val",E.mi);z()}function t(D){c.gearDate=document.createElement("div");c.gearDate.className="gearDate";c.gearDate.innerHTML='<div class="dp-outer-box"><div class="date_ctrl slideInUp" style="max-width:'+b+'"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div></div><div class="date_bg" style="width:100%;height:100%;"></div>';document.body.appendChild(c.gearDate);A();var F=c.gearDate.querySelector(".lcalendar_cancel");F.addEventListener("touchstart",e);var G=c.gearDate.querySelector(".lcalendar_finish");G.addEventListener("touchstart",j);var E=c.gearDate.querySelector(".date_bg");E.addEventListener("click",e);var H=c.gearDate.querySelector(".time_hh");var I=c.gearDate.querySelector(".time_mm");H.addEventListener("touchstart",o);I.addEventListener("touchstart",o);H.addEventListener("touchmove",m);I.addEventListener("touchmove",m);H.addEventListener("touchend",l);I.addEventListener("touchend",l);F.addEventListener("click",e);G.addEventListener("click",j);H.addEventListener("mousedown",o);I.addEventListener("mousedown",o);H.addEventListener("mousemove",m);I.addEventListener("mousemove",m);H.addEventListener("mouseup",l);I.addEventListener("mouseup",l);c.gearDate.querySelector(".date_roll_mask").addEventListener("mouseleave",n);c.gearDate.querySelector(".date_roll_mask").addEventListener("mouseup",n)}function A(){var D=new Date();var E={hh:D.getHours(),mm:D.getMinutes()};if(/^\d{2}:\d{2}$/.test(c.trigger.value)){rs=c.trigger.value.match(/(^|:)\d{2}/g);E.hh=parseInt(rs[0].replace(/^0?/g,""));E.mm=parseInt(rs[1].replace(/:0?/g,""))}c.gearDate.querySelector(".time_hh").setAttribute("val",E.hh);c.gearDate.querySelector(".time_mm").setAttribute("val",E.mm);z()}function x(){var Q=c.maxY-c.minY+1;var F=c.gearDate.querySelector(".date_yy");var H="";if(F&&F.getAttribute("val")){var S=parseInt(F.getAttribute("val"));for(var P=0;P<=Q-1;P++){H+="<div class='tooth'>"+(c.minY+P)+"</div>"}F.innerHTML=H;var R=Math.floor(parseFloat(F.getAttribute("top")));if(!isNaN(R)){R%2==0?(R=R):(R=R+1);R>8&&(R=8);var N=8-(Q-1)*2;R<N&&(R=N);F.style.transform="translate3d(0,"+R+"em,0)";F.setAttribute("top",R+"em");S=Math.abs(R-8)/2;F.setAttribute("val",S)}else{F.style.transform="translate3d(0,"+(8-S*2)+"em,0)";F.setAttribute("top",8-S*2+"em")}}else{return}var E=c.gearDate.querySelector(".date_mm");if(E&&E.getAttribute("val")){H="";var O=parseInt(E.getAttribute("val"));var J=11;var M=0;if(S==Q-1){J=c.maxM-1}if(S==0){M=c.minM-1}for(var P=0;P<J-M+1;P++){H+="<div class='tooth'>"+(M+P+1)+"</div>"}E.innerHTML=H;if(O>J){O=J;E.setAttribute("val",O)}else{if(O<M){O=J;E.setAttribute("val",O)}}E.style.transform="translate3d(0,"+(8-(O-M)*2)+"em,0)";E.setAttribute("top",8-(O-M)*2+"em")}else{return}var D=c.gearDate.querySelector(".date_dd");if(D&&D.getAttribute("val")){H="";var G=parseInt(D.getAttribute("val"));var K=d(S,O);var I=K-1;var L=0;if(S==Q-1&&c.maxM==O+1){I=c.maxD-1}if(S==0&&c.minM==O+1){L=c.minD-1}for(var P=0;P<I-L+1;P++){H+="<div class='tooth'>"+(L+P+1)+"</div>"}D.innerHTML=H;if(G>I){G=I;D.setAttribute("val",G)}else{if(G<L){G=L;D.setAttribute("val",G)}}D.style.transform="translate3d(0,"+(8-(G-L)*2)+"em,0)";D.setAttribute("top",8-(G-L)*2+"em")}else{return}}function z(){var H=c.gearDate.querySelector(".time_hh");if(H&&H.getAttribute("val")){var F="";var E=parseInt(H.getAttribute("val"));for(var D=0;D<=23;D++){F+="<div class='tooth'>"+D+"</div>"}H.innerHTML=F;H.style.transform="translate3d(0,"+(8-E*2)+"em,0)";H.setAttribute("top",8-E*2+"em")}else{return}var I=c.gearDate.querySelector(".time_mm");if(I&&I.getAttribute("val")){var F="";var G=parseInt(I.getAttribute("val"));for(var D=0;D<=59;D++){F+="<div class='tooth'>"+D+"</div>"}I.innerHTML=F;I.style.transform="translate3d(0,"+(8-G*2)+"em,0)";I.setAttribute("top",8-G*2+"em")}else{return}}function d(E,D){if(D==1){E+=c.minY;if((E%4==0&&E%100!=0)||(E%400==0&&E%4000!=0)){return 29}else{return 28}}else{if(D==3||D==5||D==8||D==10){return 30}else{return 31}}}function o(D){if(p||q){return}q=true;D.preventDefault();var E=D.target;while(true){if(!E.classList.contains("gear")){E=E.parentElement}else{break}}clearInterval(E["int_"+E.id]);E["old_"+E.id]=D.targetTouches?D.targetTouches[0].screenY:D.pageY;E["o_t_"+E.id]=(new Date()).getTime();var F=E.getAttribute("top");if(F){E["o_d_"+E.id]=parseFloat(F.replace(/em/g,""))}else{E["o_d_"+E.id]=0}v=D}function m(D){if(!q){return}p=true;D.preventDefault();if(v){var F=v.target}else{var F=D.target}while(true){if(!F.classList.contains("gear")){F=F.parentElement}else{break}}F["new_"+F.id]=D.targetTouches?D.targetTouches[0].screenY:D.pageY;F["n_t_"+F.id]=(new Date()).getTime();var E=(F["new_"+F.id]-F["old_"+F.id])*18/370;F["pos_"+F.id]=F["o_d_"+F.id]+E;F.style.transform="translate3d(0,"+F["pos_"+F.id]+"em,0)";F.setAttribute("top",F["pos_"+F.id]+"em")}function l(D){if(!q||!p){q=p=false;return}q=p=false;D.preventDefault();if(v){var F=v.target}else{var F=D.target}while(true){if(!F.classList.contains("gear")){F=F.parentElement}else{break}}var E=(F["new_"+F.id]-F["old_"+F.id])/(F["n_t_"+F.id]-F["o_t_"+F.id]);if(Math.abs(E)<=0.2){F["spd_"+F.id]=(E<0?-0.08:0.08)}else{if(Math.abs(E)<=0.5){F["spd_"+F.id]=(E<0?-0.16:0.16)}else{F["spd_"+F.id]=E/2}}if(!F["pos_"+F.id]){F["pos_"+F.id]=0}w(F);v=null}function n(D){l(v)}function w(G){var D=0;var F=false;var E=c.maxY-c.minY+1;clearInterval(G["int_"+G.id]);G["int_"+G.id]=setInterval(function(){var S=G["pos_"+G.id];var T=G["spd_"+G.id]*Math.exp(-0.1*D);S+=T;if(Math.abs(T)>0.1){}else{T=0.1;var H=Math.round(S/2)*2;if(Math.abs(S-H)<0.05){F=true}else{if(S>H){S-=T}else{S+=T}}}if(S>8){S=8;F=true}switch(G.dataset.datetype){case"date_yy":var Q=8-(E-1)*2;if(S<Q){S=Q;F=true}if(F){var K=Math.abs(S-8)/2;y(G,K);clearInterval(G["int_"+G.id])}break;case"date_mm":var J=c.gearDate.querySelector(".date_yy");var U=parseInt(J.getAttribute("val"));var M=11;var P=0;if(U==E-1){M=c.maxM-1}if(U==0){P=c.minM-1}var Q=8-(M-P)*2;if(S<Q){S=Q;F=true}if(F){var K=Math.abs(S-8)/2+P;y(G,K);clearInterval(G["int_"+G.id])}break;case"date_dd":var J=c.gearDate.querySelector(".date_yy");var I=c.gearDate.querySelector(".date_mm");var U=parseInt(J.getAttribute("val"));var R=parseInt(I.getAttribute("val"));var N=d(U,R);var L=N-1;var O=0;if(U==E-1&&c.maxM==R+1){L=c.maxD-1}if(U==0&&c.minM==R+1){O=c.minD-1}var Q=8-(L-O)*2;if(S<Q){S=Q;F=true}if(F){var K=Math.abs(S-8)/2+O;y(G,K);clearInterval(G["int_"+G.id])}break;case"time_hh":if(S<-38){S=-38;F=true}if(F){var K=Math.abs(S-8)/2;y(G,K);clearInterval(G["int_"+G.id])}break;case"time_mm":if(S<-110){S=-110;F=true}if(F){var K=Math.abs(S-8)/2;y(G,K);clearInterval(G["int_"+G.id])}break;default:}G["pos_"+G.id]=S;G.style.transform="translate3d(0,"+S+"em,0)";G.setAttribute("top",S+"em");D++},30)}function y(D,E){E=Math.round(E);D.setAttribute("val",E);if(/date/.test(D.dataset.datetype)){x()}else{z()}}function e(D){D.preventDefault();q=p=false;if(c.onClose){c.onClose()}var E=new CustomEvent("input");c.trigger.dispatchEvent(E);document.body.removeChild(c.gearDate)}function h(G){var H=c.maxY-c.minY+1;var F=parseInt(Math.round(c.gearDate.querySelector(".date_yy").getAttribute("val")));var E=parseInt(Math.round(c.gearDate.querySelector(".date_mm").getAttribute("val")))+1;E=E>9?E:"0"+E;var D=parseInt(Math.round(c.gearDate.querySelector(".date_dd").getAttribute("val")))+1;D=D>9?D:"0"+D;c.trigger.value=(F%H+c.minY)+"-"+E+"-"+D;c.value=c.trigger.value;if(c.onSubmit){c.onSubmit()}e(G)}function k(F){var G=c.maxY-c.minY+1;var E=parseInt(Math.round(c.gearDate.querySelector(".date_yy").getAttribute("val")));var D=parseInt(Math.round(c.gearDate.querySelector(".date_mm").getAttribute("val")))+1;D=D>9?D:"0"+D;c.trigger.value=(E%G+c.minY)+"-"+D;c.value=c.trigger.value;if(c.onSubmit){c.onSubmit()}e(F)}function i(G){var H=c.maxY-c.minY+1;var F=parseInt(Math.round(c.gearDate.querySelector(".date_yy").getAttribute("val")));var E=parseInt(Math.round(c.gearDate.querySelector(".date_mm").getAttribute("val")))+1;E=E>9?E:"0"+E;var D=parseInt(Math.round(c.gearDate.querySelector(".date_dd").getAttribute("val")))+1;D=D>9?D:"0"+D;var I=parseInt(Math.round(c.gearDate.querySelector(".time_hh").getAttribute("val")));I=I>9?I:"0"+I;var J=parseInt(Math.round(c.gearDate.querySelector(".time_mm").getAttribute("val")));J=J>9?J:"0"+J;c.trigger.value=(F%H+c.minY)+"-"+E+"-"+D+" "+(I.length<2?"0":"")+I+(J.length<2?":0":":")+J;c.value=c.trigger.value;if(c.onSubmit){c.onSubmit()}e(G)}function j(D){var E=parseInt(Math.round(c.gearDate.querySelector(".time_hh").getAttribute("val")));E=E>9?E:"0"+E;var F=parseInt(Math.round(c.gearDate.querySelector(".time_mm").getAttribute("val")));F=F>9?F:"0"+F;c.trigger.value=(E.length<2?"0":"")+E+(F.length<2?":0":":")+F;c.value=c.trigger.value;if(c.onSubmit){c.onSubmit()}e(D)}c.trigger.onclick={ym:u,date:r,datetime:s,time:t}[B]}};return a})();